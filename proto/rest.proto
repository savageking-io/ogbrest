syntax = "proto3";

package rest;
option go_package = "github.com/savageking-io/ogbrest/proto";

import "google/protobuf/timestamp.proto";

service RestInterService {
  rpc AuthInterService (rest.AuthenticateServiceRequest) returns (rest.AuthenticateServiceResponse);
  rpc RequestRestData (rest.RestDataRequest) returns (rest.RestDataDefinition);
  rpc NewRestRequest (rest.RestApiRequest) returns (rest.RestApiResponse);
  rpc Ping (rest.PingMessage) returns (rest.PingMessage);
}

message AuthenticateServiceRequest {
  string Token = 1;
}

message AuthenticateServiceResponse {
  int32 Code = 1;
  int32 ServiceId = 2;
  string Error = 3;
}

message RestDataRequest {
  int32 Version = 1;
}

message RestDataDefinition {
  int32 Code = 1;
  string Error = 2;
  string Root = 3;
  int32 EndpointsNum = 4;
  repeated RestEndpoint endpoints = 5;
  string Version = 6;
}

message RestEndpoint {
  string Path = 1;
  string Method = 2;
  bool SkipAuthMiddleware = 3;
}

message RestApiRequest {
  string Uri = 1;
  string Method = 2;
  repeated RestHeader Headers = 3;
  string Body = 4;
  string Source = 5;
  repeated RestApiFormData Form = 6;
}

message RestApiFormData {
  string Key = 1;
  repeated string Value = 2;
}

message RestApiResponse {
  int32 Code = 1;
  string Error = 2;
  int32 HttpCode = 3;
  repeated RestHeader Headers = 4;
  string Body = 5;
}

message RestHeader {
  string Key = 1;
  string Value = 2;
}

message PingMessage {
  google.protobuf.Timestamp SentAt = 1;
  google.protobuf.Timestamp RepliedAt = 2;
}